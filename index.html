<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Кликер</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding-top: 50px;
      background: linear-gradient(135deg, #FDE68A, #F59E0B);
      margin: 0;
      color: #333;
      overflow-x: hidden;
    }

    #clicker-container {
      max-width: 400px;
      margin: 0 auto;
      background: #fff7d1;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 15px rgba(0,0,0,0.1);
      min-height: 280px;
      position: relative;
    }

    button {
      cursor: pointer;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 18px;
      font-weight: bold;
      color: white;
      background-color: #f59e0b;
      transition: transform 0.2s ease, background-color 0.3s ease;
      margin: 8px;
      min-width: 140px;
    }

    button:hover {
      background-color: #d97706;
      transform: scale(1.05);
    }

    .clicked {
      transform: scale(1.2);
      transition: transform 0.1s ease;
    }

    .info {
      font-size: 20px;
      margin: 12px 0;
    }

    .menu {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 10;
    }

    .menu button {
      padding: 8px 14px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      background-color: #f59e0b;
      color: white;
      cursor: pointer;
      transition: transform 0.2s ease, opacity 0.2s ease;
      min-width: 80px;
    }

    .menu button:hover {
      background-color: #d97706;
      transform: scale(1.2);
    }

    .menu:hover button:not(:hover) {
      transform: scale(0.9);
      opacity: 0.7;
    }


    #nicknameModal {
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    #nicknameModalContent {
      background: white;
      padding: 30px 40px;
      border-radius: 12px;
      max-width: 320px;
      text-align: center;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }

    #nicknameModalContent input {
      font-size: 18px;
      padding: 10px;
      width: 100%;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-top: 10px;
      box-sizing: border-box;
    }

    #nicknameModalContent button {
      margin-top: 20px;
      width: 100%;
      background-color: #f59e0b;
    }

    #nicknameModalContent button:hover {
      background-color: #d97706;
    }

    #errorMsg {
      color: red;
      margin-top: 10px;
      min-height: 18px;
      font-weight: bold;
    }

    #leaderboardList {
      text-align: left;
      margin-top: 10px;
      max-height: 200px;
      overflow-y: auto;
      font-size: 18px;
    }

    #leaderboardList div {
      padding: 6px 0;
      border-bottom: 1px solid #f0c14b;
    }
  </style>
</head>
<body>
  <h1>Кликер</h1>

  <div class="menu">
    <button id="eggsButton">Яйца</button>
    <button id="inventoryButton">Инвентарь</button>
    <button id="settingsButton">Настройки</button>
    <button id="leaderboardButton">Лидеры</button>
  </div>

  <div id="clicker-container"></div>


  <div id="nicknameModal" style="display:none;">
    <div id="nicknameModalContent">
      <h2>Введите свой никнейм</h2>
      <input type="text" id="nicknameInput" placeholder="Ваш ник" maxlength="15" autocomplete="off" />
      <div id="errorMsg"></div>
      <button id="saveNicknameBtn">Сохранить</button>
    </div>
  </div>

<script>

  let score = 0;
  let clickPower = 1;
  let clickCooldown = 1.5;
  let lastClickTime = 0;
  let cooldownStepIndex = 0;
  let playerNick = null;

  const badWords = ['член','сперма','нахуй','хуй','пизд','еба','бля','сука','нах','бляд','долбоёб','уебок','пидр','пидар'];

  const cooldownSteps = [
    { from: 1.5, to: 1.4, price: 1000 },
    { from: 1.4, to: 1.3, price: 10000 },
    { from: 1.3, to: 1.2, price: 100000 },
    { from: 1.2, to: 1.1, price: 1000000 },
    { from: 1.1, to: 1.0, price: 10000000 },
    { from: 1.0, to: 0.9, price: 100000000 },
    { from: 0.9, to: 0.8, price: 1000000000 },
    { from: 0.8, to: 0.7, price: 10000000000 },
    { from: 0.7, to: 0.6, price: 100000000000 },
  ];

  const clickerContainer = document.getElementById('clicker-container');
  const eggsButton = document.getElementById('eggsButton');
  const inventoryButton = document.getElementById('inventoryButton');
  const settingsButton = document.getElementById('settingsButton');
  const leaderboardButton = document.getElementById('leaderboardButton');

  let activeMenu = null;

  function formatNumber(num) {
    return num.toLocaleString('en-US');
  }

  function containsBadWords(text) {
    text = text.toLowerCase();
    return badWords.some(word => text.includes(word));
  }

  function loadData() {
    const data = localStorage.getItem('clickerSave');
    if (data) {
      const parsed = JSON.parse(data);
      score = parsed.score || 0;
      clickPower = parsed.clickPower || 1;
      clickCooldown = parsed.clickCooldown || 1.5;
      cooldownStepIndex = parsed.cooldownStepIndex || 0;
    }
  }

  function saveData() {
    const data = {
      score,
      clickPower,
      clickCooldown,
      cooldownStepIndex
    };
    localStorage.setItem('clickerSave', JSON.stringify(data));
  }

  function saveNick(nick) {
    playerNick = nick;
    localStorage.setItem('playerNick', nick);
  }

  function loadNick() {
    return localStorage.getItem('playerNick');
  }

  const nicknameModal = document.getElementById('nicknameModal');
  const nicknameInput = document.getElementById('nicknameInput');
  const saveNicknameBtn = document.getElementById('saveNicknameBtn');
  const errorMsg = document.getElementById('errorMsg');

  function showNicknameModal() {
    nicknameModal.style.display = 'flex';
    nicknameInput.value = '';
    errorMsg.textContent = '';
    nicknameInput.focus();
  }

  function trySaveNickname() {
    const nick = nicknameInput.value.trim();
    if (!nick) {
      errorMsg.textContent = 'Ник не может быть пустым!';
      return;
    }
    if (containsBadWords(nick)) {
      errorMsg.textContent = 'Ник содержит недопустимые слова!';
      return;
    }
    saveNick(nick);
    nicknameModal.style.display = 'none';
    updateLeaderBoardWithCurrent();
    renderClicker();
  }

  saveNicknameBtn.addEventListener('click', trySaveNickname);
  nicknameInput.addEventListener('keydown', e => {
    if(e.key === 'Enter') trySaveNickname();
  });

  function animateButton(button) {
    button.classList.add('clicked');
    setTimeout(() => {
      button.classList.remove('clicked');
    }, 100);
  }

  function renderClicker() {
    if (!playerNick) {
      showNicknameModal();
      return;
    }

    clickerContainer.innerHTML = `
      <div class="info">Игрок: <b>${playerNick}</b></div>
      <div class="info">Очки: <span id="score">${formatNumber(score)}</span></div>
      <button id="clickButton">Кликни!</button>
      <div class="info">Сила клика: <span id="clickPower">${formatNumber(clickPower)}</span></div>
      <button id="upgradeClickPowerButton">Улучшить клик (10 очков)</button>
      <div class="info">Кулдаун клика (сек): <span id="clickCooldown">${clickCooldown.toFixed(1)}</span></div>
      <button id="upgradeCooldownButton"></button>
    `;

    updateCooldownButton();

    document.getElementById('clickButton').addEventListener('click', () => {
      const now = Date.now();
      if (now - lastClickTime < clickCooldown * 1000) return;
      lastClickTime = now;
      score += clickPower;
      updateUI();
      animateButton(document.getElementById('clickButton'));
      saveData();
      updateLeaderBoardWithCurrent();
    });

    document.getElementById('upgradeClickPowerButton').addEventListener('click', () => {
      if (score >= 10) {
        score -= 10;
        clickPower++;
        updateUI();
        animateButton(document.getElementById('upgradeClickPowerButton'));
        saveData();
        updateLeaderBoardWithCurrent();
      } else {
        alert('Недостаточно очков для улучшения!');
      }
    });

    document.getElementById('upgradeCooldownButton').addEventListener('click', () => {
      if (cooldownStepIndex >= cooldownSteps.length) return;
      const step = cooldownSteps[cooldownStepIndex];
      if (score >= step.price) {
        score -= step.price;
        clickCooldown = step.to;
        cooldownStepIndex++;
        updateUI();
        animateButton(document.getElementById('upgradeCooldownButton'));
        saveData();
        updateLeaderBoardWithCurrent();
      } else {
        alert('Недостаточно очков для улучшения кулдауна!');
      }
    });
  }

  function updateCooldownButton() {
    const btn = document.getElementById('upgradeCooldownButton');
    if (!btn) return;
    if (cooldownStepIndex < cooldownSteps.length) {
      const step = cooldownSteps[cooldownStepIndex];
      btn.textContent = `Уменьшить кулдаун (цена: ${formatNumber(step.price)} очков)`;
      btn.disabled = false;
      btn.style.opacity = 1;
    } else {
      btn.textContent = 'Кулдаун улучшен по максимуму';
      btn.disabled = true;
      btn.style.opacity = 0.6;
    }
  }

  function updateUI() {
    document.getElementById('score').textContent = formatNumber(score);
    document.getElementById('clickPower').textContent = formatNumber(clickPower);
    document.getElementById('clickCooldown').textContent = clickCooldown.toFixed(1);
    updateCooldownButton();
  }



  const menuContent = {
    eggs: `<h2>Яйца</h2><p>Здесь будут яйца...</p>`,
    inventory: `<h2>Инвентарь</h2><p>Ваш инвентарь пуст...</p>`,
    settings: `<h2>Настройки</h2>
      <p>Текущий ник: <b id="currentNickDisplay"></b></p>
      <input type="text" id="changeNickInput" placeholder="Новый ник" maxlength="15" autocomplete="off" />
      <div id="settingsError" style="color:red; min-height:20px;"></div>
      <button id="changeNickBtn">Сменить ник</button>
    `,
    leaderboard: `<h2>Лидерборд</h2>
      <div id="leaderboardList"></div>
    `
  };

  function openMenu(menuKey) {
    if (activeMenu === menuKey) {

      activeMenu = null;
      renderClicker();
      return;
    }
    activeMenu = menuKey;
    clickerContainer.innerHTML = menuContent[menuKey] || '';
    if (menuKey === 'settings') {
      document.getElementById('currentNickDisplay').textContent = playerNick;
      const input = document.getElementById('changeNickInput');
      const errorDiv = document.getElementById('settingsError');
      const btn = document.getElementById('changeNickBtn');

      btn.onclick = () => {
        const newNick = input.value.trim();
        errorDiv.textContent = '';
        if (!newNick) {
          errorDiv.textContent = 'Ник не может быть пустым!';
          return;
        }
        if (containsBadWords(newNick)) {
          errorDiv.textContent = 'Ник содержит недопустимые слова!';
          return;
        }
        saveNick(newNick);
        errorDiv.style.color = 'green';
        errorDiv.textContent = 'Ник успешно изменён!';
        setTimeout(() => {
          errorDiv.textContent = '';
          errorDiv.style.color = 'red';
          openMenu(null);
          renderClicker();
        }, 1500);
        updateLeaderBoardWithCurrent();
      };
    } else if (menuKey === 'leaderboard') {
      renderLeaderBoard();
    }
  }

  eggsButton.addEventListener('click', () => openMenu('eggs'));
  inventoryButton.addEventListener('click', () => openMenu('inventory'));
  settingsButton.addEventListener('click', () => openMenu('settings'));
  leaderboardButton.addEventListener('click', () => openMenu('leaderboard'));


  function loadAllPlayers() {
    const raw = localStorage.getItem('allPlayers');
    if (!raw) return {};
    try {
      return JSON.parse(raw);
    } catch {
      return {};
    }
  }

  function saveAllPlayers(players) {
    localStorage.setItem('allPlayers', JSON.stringify(players));
  }


  function updateLeaderBoardWithCurrent() {
    if (!playerNick) return;
    const players = loadAllPlayers();
    players[playerNick] = score;
    saveAllPlayers(players);
  }


  function renderLeaderBoard() {
    const leaderboardDiv = document.getElementById('leaderboardList');
    if (!leaderboardDiv) return;

    const players = loadAllPlayers();

    const playersArr = Object.entries(players);

    playersArr.sort((a,b) => b[1] - a[1]);

    let html = '';
    if(playersArr.length === 0) {
      html = '<p>Пока нет игроков.</p>';
    } else {
      const top = playersArr.slice(0,3);
      top.forEach(([nick, points], i) => {
        const isCurrent = (nick === playerNick);
        html += `<div style="font-weight:${isCurrent ? 'bold' : 'normal'};">
          ${i+1}. ${escapeHtml(nick)} — ${formatNumber(points)} кликов
        </div>`;
      });
    }
    leaderboardDiv.innerHTML = html;
  }

  function escapeHtml(text) {
    return text.replace(/[&<>"']/g, (m) => {
      switch (m) {
        case '&': return '&amp;';
        case '<': return '&lt;';
        case '>': return '&gt;';
        case '"': return '&quot;';
        case "'": return '&#39;';
        default: return m;
      }
    });
  }

  function init() {
    playerNick = loadNick();
    loadData();
    if (!playerNick) {
      showNicknameModal();
    } else {
      renderClicker();
      updateLeaderBoardWithCurrent();
    }
  }

  window.onload = init;

</script>

</body>
</html>
